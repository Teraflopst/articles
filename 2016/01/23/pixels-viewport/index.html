<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 移动前端开之像素、viewport 的理解 · one stark</title><meta name="description" content="移动前端开之像素、viewport 的理解 - Hewenwei"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/fav.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="http://fonts.useso.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><header><a href="/" class="logo-link"><img src="/fav.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">HOME</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">存档</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">关于</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">移动前端开之像素、viewport 的理解</h1><div class="post-time">Jan 23, 2016</div><div class="post-content"><h2 id="知识"><a href="#知识" class="headerlink" title="知识"></a>知识</h2><h3 id="CSS-像素、物理像素、PPI"><a href="#CSS-像素、物理像素、PPI" class="headerlink" title="CSS 像素、物理像素、PPI"></a>CSS 像素、物理像素、PPI</h3><h4 id="CSS-像素"><a href="#CSS-像素" class="headerlink" title="CSS 像素"></a>CSS 像素</h4><p><code>CSS像素</code> 是 Web 编程的概念，本质上是为我们 Web 开发者创建的一个抽象结构，是相对的而不是绝对的。</p>
<h4 id="物理像素"><a href="#物理像素" class="headerlink" title="物理像素"></a>物理像素</h4><p><code>物理像素</code> 是物理概念，屏幕是由很多像素点组成的，各像素点通过发出不同颜色的光来呈现屏幕的色彩。它是物理的，随着设备生产出来就已经被确定下来了，比如 iPhone4 的屏幕分辨率为 640×960，就表示屏幕的横向有640个像素点，纵向有960个像素点。</p>
<h4 id="PPI"><a href="#PPI" class="headerlink" title="PPI"></a>PPI</h4><p>PPI（Pixels Per Inch）表示单位面积上的物理像素点数目。分辨率可以表示屏幕包含的像素数目，但要想描述屏幕的显示质量，还需要知道屏幕尺寸，最后算出单位面积上的像素点数目。显然PPI越高，屏幕显示效果越细腻。</p>
<p>想要解释 <code>CSS像素</code> 和 <code>设备像素</code> 的关系也很简单，想想 PC 浏览器网页上的缩放。如果用户进行放大操作，一个拥有 <code>width: 300px</code> 的元素将会占有屏幕越来越多的空间，以设备（物理）像素进行度量的话就会变得越来越宽。但对于 CSS 像素来说，无论怎样，宽度的值还是 <code>300px</code>，缩放效果是通过尽可能的对 CSS 像素进行拉伸来实现的。</p>
<p>平时电脑屏幕的 1px CSS 像素对应 1px 物理像素，所以感觉不到两者的区别，会让你误以为CSS 里的 <code>px</code> 就是实际屏幕像素。而真实情况是：</p>
<ul>
<li>当缩放比例为 100% 时（不缩放），1px CSS 像素对应屏幕物理像素 1px；</li>
<li>当缩放比例大于 100% 时（放大），1px CSS 像素对应大于 1px 的屏幕物理像素；</li>
<li>当缩放比例小于 100% 时（缩小），1px CSS 像素对应小于 1px 的屏幕物理像素。</li>
</ul>
<p>下来的两幅图说明了当用户缩放的时候会发生什么。第一幅图展示的是当用户进行缩小操作的时候设备像素（深蓝色背景）和 CSS 像素（半透明前景）的样子。CSS 像素变得小了；一个设备像素覆盖了多个 CSS 像素。第二幅图展示的当用户进行放大操作时候设备像素和CSS像素的样子。一个CSS 像素现在覆盖了多个设备像素。（图左：放大网页，图右：缩小网页）</p>
<p><img src="/media/csspixels_in_out.png" alt="csspixels_in_out" title="title"></p>
<h3 id="逻辑像素、设备像素比"><a href="#逻辑像素、设备像素比" class="headerlink" title="逻辑像素、设备像素比"></a>逻辑像素、设备像素比</h3><p>过去 iPhone 3gs 分辨率是 320x480，和平时电脑屏幕一样，1px CSS 像素对应 1px 物理像素，开发者开发网页时只要写上 CSS 像素 <code>width:320px, height:480px</code> 即可。但是，面对同样屏幕尺寸的 iPhone 4/4s，分辨率提升到 640x960，难道要另外为它写一份网页文档设置 CSS 像素 <code>width:640px, height:960px</code> 来适配高分辨率吗，显然这是不实际的。如果继续使用旧的网页文件，在高分辨率的设备上，就会显得很小，比如在分辨率为 320×480 的 iPhone 3GS 上，要画一条长度 1 英寸的线条，假设需要 163 个物理像素，即CSS像素设成 163 像素即可；但是在分辨率为 640×960 的 iPhone4/4s 上，163 CSS 像素所在手机表示实际长度只有 iPhone3GS 的一半，即 0.5 英寸。如果照这种方式显示，3GS 上刚刚好的效果，在 4/4s 上就会小到根本看不清了。</p>
<p>而在现实中，这两者效果却是一样的！这是因为 Retina 屏幕把 2x2 个像素当 1 个像素使用。比如原本 44 像素高的顶部导航栏，在 Retina 屏上用了 88 个像素的高度来显示。如下图：</p>
<p><img src="/media/iphone3_4.png" alt="iphone3_4"></p>
<h4 id="逻辑像素"><a href="#逻辑像素" class="headerlink" title="逻辑像素"></a>逻辑像素</h4><p>这里提出<code>逻辑像素</code>的概念。苹果使用了一套逻辑坐标系统来解决多分辨率屏幕适配问题，<br>例如：4/4s 的逻辑像素设为 320x480 <strong>points</strong> ，即物理屏幕上左上角为原点，横向为 X 轴 320 points，纵向为 Y 轴 480 points，名为 point (即pt) 单位就是上图中的深灰色部分，显然，PPI 越高的屏幕，1 point 覆盖的物理像素就越多。Android 平台也定义了逻辑像素单位，为<code>device-independent pixel</code> 即 dip 或 dp。说实话，两者其实是一回事。</p>
<h4 id="设备像素比"><a href="#设备像素比" class="headerlink" title="设备像素比"></a>设备像素比</h4><p>设备像素比(devicePixelRatio) = 物理像素 / dp或pt。例如：<br>iPhone 4/4s 设备像素比：640 / 320 = 2</p>
<p>单位之间的换算关系：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1倍：1pt=1dp=1px（iPhone 3GS）</span><br><span class="line">2倍：1pt=1dp=2px（iPhone 4s/5/6）</span><br><span class="line">3倍：1pt=1dp=3px（iPhone 6 plus）</span><br></pre></td></tr></table></figure>
<h2 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h2><h3 id="CSS-和-图片"><a href="#CSS-和-图片" class="headerlink" title="CSS 和 图片"></a>CSS 和 图片</h3><p>对于开发者，实际应用中应该根据屏幕尺寸和 devicePixelRatio 来反推 CSS pixel。</p>
<p>也就是说：假设设备像素比为 2，设计图要做成了 720x1280 的，那么 CSS 里所有尺寸都除以 2 即可。</p>
<p>而对于图片，比如一张实际大小 100x100px 的图片，并且 width 和 height 都设了 100px(注意这里的px是css pixel)，实际占用了屏幕的像素数就是(假设设备像素比是3) 300x300px (注意这里的 px 是真实的屏幕像素) 所以，如果希望网页的元素在高 PPI 设备上显示不模糊(比如 1080x1920 屏幕的手机)，位图应该做 3 倍的尺寸 (比如做 300x300px 的图，然后在 CSS 中设 width 和 height 为 100px)，svg(矢量图)就无所谓了。</p>
<h3 id="媒体查询"><a href="#媒体查询" class="headerlink" title="媒体查询"></a>媒体查询</h3><p>注意这里的 px 是指逻辑像素，即 CSS 文件中的 width、height。<br><code>max-width</code> 和 <code>max-device-width</code> 都可以使用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@media all and (max-device-width: 320px) &#123;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="viewport"><a href="#viewport" class="headerlink" title="viewport"></a>viewport</h2><p>别以为当我们为了适配手机端的问题，而特意根据屏幕尺寸和 devicePixelRatio 来反推 CSS pixel，就可以在手机端上优雅地显示网页了，手机浏览器又涉及到有关 viewport 的概念。这里介绍一下 layout viewport 和 visual viewport。</p>
<ul>
<li>layout viewport - 为了更好渲染页面所需要的尺寸</li>
<li>visual viewport - 浏览器可视区域尺寸</li>
</ul>
<h3 id="layout-viewport"><a href="#layout-viewport" class="headerlink" title="layout viewport"></a>layout viewport</h3><p>移动设备上的浏览器认为自己必须能让所有的网站都正常显示，即使是那些不是为移动设备设计的网站。但如果以浏览器的可视区域作为 viewport 的话，因为移动设备的屏幕都不是很宽，所以那些为桌面浏览器设计的网站放到移动设备上显示时，必然会因为移动设备的 viewport 太窄，而挤作一团，甚至布局什么的都会乱掉。所以这些浏览器就决定默认情况下把 viewport 设为一个较宽的值，比如 980px，这样的话即使是那些为桌面设计的网站也能在移动浏览器上正常显示了。ppk 把这个浏览器默认的 viewport 叫做 layout viewport。</p>
<p><img src="/media/layoutviewport.png" alt="layoutviewport"></p>
<h3 id="visual-viewport"><a href="#visual-viewport" class="headerlink" title="visual viewport"></a>visual viewport</h3><p>layout viewport 的宽度是大于浏览器可视区域的宽度的，所以我们还需要一个 viewport 来代表浏览器可视区域的大小，ppk 把这个 viewport 叫做 visual viewport。</p>
<p><img src="/media/visualviewport.png" alt="visualviewport"></p>
<p>拿 iPhone 举例。<br>iPhone 创建出了一个 980px 的虚拟窗口——布局窗口(layout viewport)来对页面布局，这时传统的桌面端网页终于能正常布局了(虽然要放大才能看清)，但正是这个 layout viewport 导致专门根据屏幕尺寸和 devicePixelRatio 优化过的页面也只能以缩放的方式显示(可以想象在你的 PC 浏览器宽 980px 窗口里打开一个 320px 的页面的情景…)，那么为了让为移动设备优化过的网页正常显示，就要改变这个 layout viewport。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0, user-scalable=no&quot;/&gt;</span><br></pre></td></tr></table></figure>
<p>布局窗口定义为：宽度为设备宽度，初始缩放比例为1倍，禁止用户缩放。</p>
<h2 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h2><p><a href="http://www.quirksmode.org/blog/archives/2010/04/a_pixel_is_not.html" target="_blank" rel="external">ppk: A pixel is not a pixel is not a pixel</a></p>
<p><a href="http://www.w3cplus.com/css/A-pixel-is-not-a-pixel-is-not-a-pixel.html" target="_blank" rel="external">W3cplus 译：此像素非彼像素</a></p>
<p><a href="http://weizhifeng.net/a-pixel-is-not.html" target="_blank" rel="external">JeremyWei 译：不是像素的像素不是像素</a></p>
<p><a href="http://www.cnblogs.com/2050/p/3877280.html" target="_blank" rel="external">移动前端开发之viewport的深入理解</a></p>
<p><a href="http://colachan.com/post/3435" target="_blank" rel="external">移动端尺寸基础知识</a></p>
<p><a href="http://www.zhangxinxu.com/wordpress/2012/08/window-devicepixelratio/" target="_blank" rel="external">张鑫旭：设备像素比devicePixelRatio简单介绍</a></p>
<p><a href="http://screensiz.es/phone" target="_blank" rel="external">SCREENSIZ.ES</a></p>
<p><a href="https://pic3.zhimg.com/9d9467e5f217fe707ce6d03aa1cd6ca6_r.jpg" target="_blank" rel="external">iPhone 分辨率终极指南</a></p>
</div></article></div></section><footer><div class="paginator"><a href="/2016/03/07/baiduyun-download-faster/" class="prev">PREV</a><a href="/2015/08/23/px-em-rem/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'onestark';
var disqus_identifier = '2016/01/23/pixels-viewport/';
var disqus_title = '移动前端开之像素、viewport 的理解';
var disqus_url = 'http://yoursite.com/2016/01/23/pixels-viewport/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//onestark.disqus.com/count.js" async></script><div class="copyright"><p>© 2015 - 2016 <a href="http://yoursite.com">Hewenwei</a>, unless otherwise noted.</p></div></footer><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>